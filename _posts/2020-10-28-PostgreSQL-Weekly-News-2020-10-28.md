---
layout: post
title: PostgreSQL æ¯å‘¨æ–°é—» 2020-10-28
---
### PostgreSQLæ¯å‘¨æ–°é—»#379 - 2020å¹´10æœˆ28æ—¥
![_config.yml]({{ site.baseurl }}/images/PostgresWeekly.png)
å¤‡æ³¨ï¼š[è‹±æ–‡åŸæ–‡åœ°å€](https://postgresweekly.com/issues/379)
![img](https://res.cloudinary.com/cpress/image/upload/w_1280,e_sharpen:60/op8ufo6wzgsrbo2yfw0z.jpg)
## [DBAå¦‚ä½•ä½¿ç”¨Postgresæ¥å‘ç°è¢«é”™è¯¯æ¸…é™¤çš„40Ké€‰æ°‘ä¿¡æ¯](https://postgresweekly.com/link/97512/web)
ä¸€ä½é•¿æœŸçš„æ•°æ®åº“ç®¡ç†å‘˜å¯¹é€‰æ°‘æ•°æ®è¿è¡ŒæŸ¥è¯¢ï¼Œä»¥å­¦ä¹ å¦‚ä½•ä½¿ç”¨Postgresï¼Œå¹¶å¶ç„¶å‘ç°äº†ä¸€ä¸ªä¸¥é‡çš„é€‰æ°‘æ¸…é™¤é”™è¯¯ã€‚ ï¼ˆæåˆ°Postgresçš„éƒ¨åˆ†å¤§çº¦åœ¨4åˆ†é’Ÿå¤„ã€‚ï¼‰


`VICE (on YouTube) `
## [æ”¹å–„Postgresè¿æ¥å¯ä¼¸ç¼©æ€§ï¼šå¿«ç…§](https://postgresweekly.com/link/97514/web)
ä»ä»–å¯¹è¿æ¥å¯ä¼¸ç¼©æ€§çš„è§’åº¦å‡ºå‘ï¼ŒAndresç»§ç»­è§£é‡Šäº†ä»–åœ¨Postgres 14ä¸­å¯¹å¿«ç…§æ‰€åšçš„æ”¹è¿›ï¼Œå¹¶ç€çœ¼äºæ€§èƒ½çš„æ”¹è¿›ã€‚


`Andres Freund `
## [å¦‚ä½•åŠ å¿«PostgresæŸ¥è¯¢çš„æœ€ä½³åšæ³•ã€‚ å…è´¹ç”µå­ä¹¦](https://postgresweekly.com/link/97516/web)
æˆ‘ä»¬åˆ†äº«äº†å¸®åŠ©Atlassianï¼ŒRobinhoodç­‰å…¬å¸åŠ å¿«æŸ¥è¯¢é€Ÿåº¦çš„ç»éªŒã€‚


`pganalyze `
## [Slonikï¼šå…ˆè¿›çš„Node.js Postgreså®¢æˆ·ç«¯åº“](https://postgresweekly.com/link/97517/web)
ç»è¿‡å®è·µæ£€éªŒçš„æ¡†æ¶ï¼Œå¯ä»¥æŠ½è±¡å‡ºé‡å¤çš„ä»£ç æ¨¡å¼ï¼Œé˜²æ­¢ä¸å®‰å…¨çš„è¡Œä¸ºï¼Œå¹¶æä¾›ä¸°å¯Œçš„è°ƒè¯•ä½“éªŒã€‚ å¦‚æœæ‚¨å®Œå…¨ä½¿ç”¨Nodeä¸­çš„Postgresï¼Œè¿™ç¯‡æ–‡å€¼å¾—ä¸€çœ‹ã€‚


`Gajus Kuizinas `
## [ä½¿ç”¨Postgresæ¥å¡‘é€ å’Œå‡†å¤‡ç§‘å­¦æ•°æ®](https://postgresweekly.com/link/97518/web)
è€Œä¸æ˜¯ä¾é Google Sheetsæˆ–å¿«é€Ÿçš„Pythonè„šæœ¬ï¼ˆä¸¤è€…éƒ½å¾ˆå¥½ï¼ï¼‰ï¼ŒSteveåªæƒ³å°†Postgresç”¨äºæ•°æ®å»ºæ¨¡ä»»åŠ¡ï¼Œè€Œè¿™ç¯‡æ–‡æè¿°å‘ç”Ÿçš„æƒ…å†µã€‚


`Steve Pousty `
## [ä½¿ç”¨SQLéšæœºé‡‡æ ·æ•°æ®](https://postgresweekly.com/link/97519/web)
æ•°æ®é‡‡æ ·çš„æ•°æ®å»ºæ¨¡çš„åç»­æ–‡ç« ã€‚


`Steve Pousty `
## [åœ¨Postgresä¸­æ£€æµ‹æ—¶é—´åºåˆ—æ•°æ®ä¸­çš„é—´éš™](https://postgresweekly.com/link/97520/web)
å³ä½¿æ‚¨æ²¡æœ‰è¿™ä¸ªé—®é¢˜ï¼Œä¹Ÿå¯ä»¥é€šè¿‡åˆ›é€ æ€§çš„æ–¹æ³•è§£å†³è¯¥é—®é¢˜ã€‚


`David Christensen `
## [åœ¨GitHubå’ŒPGXNä¸Šè‡ªåŠ¨åŒ–Postgresæ‰©å±•ç‰ˆæœ¬](https://postgresweekly.com/link/97521/web)
æˆ‘å¾ˆæƒ³çŸ¥é“å®é™…ä¸Šæœ‰å¤šå°‘äººç¼–å†™è‡ªå·±çš„æ‰©å±•ï¼Œä½†æ˜¯å¦‚æœæ‚¨è¿™æ ·åšï¼Œè¿™é‡Œæœ‰ä¸€äº›æœ‰ç”¨çš„çŸ¥è¯†ï¼Œå¯ä»¥é€šè¿‡GitHubåœ¨GitHubå’ŒPGXNä¸Šè‡ªåŠ¨åŒ–å‘å¸ƒæ‰©å±•ã€‚ 


`David E. Wheeler `
## [ä½¿ç”¨Scalefield-æ‚¨çš„ç§æœ‰Postgresäº‘æ•°æ®åº“](https://postgresweekly.com/link/97522/web)
Scalefieldå¯è®©æ‚¨è½»æ¾åœ°åœ¨è‡ªå·±çš„äº‘ä¸­æ‰˜ç®¡PostgreSQLé›†ç¾¤-å®Œå…¨çµæ´»ï¼Œå¯æ‰©å±•ä¸”å¯é ã€‚


`CYBERTEC `
## [SQLä¸­çš„å¤–é”®å’Œæ’å…¥é¡ºåº](https://www.cybertec-postgresql.com/en/postgresql-foreign-keys-and-insertion-order-in-sql/)


`HANS-JÃœRGEN SCHÃ–NIG`
## [ä½¿ç”¨â€œLIKEâ€åšjoinï¼Œæˆ–è€…ä¸ºä»€ä¹ˆPostgreSQL FTSæ˜¯ä¸€ä¸ªå¼ºå¤§çš„æ›¿ä»£æ–¹æ¡ˆ](https://postgrespro.co.il/blog/joins-using-like-or-why-postgresql-fts-is-a-powerful-alternative/)

`VADIM YATSENKO`
## [å…³äºPostgresåˆ†åŒºçš„å¹¿æ³›ç½‘ç»œç ”è®¨ä¼š](https://www.2ndquadrant.com/en/blog/postgresql-partitioning-by-simon-riggs-full-webinar-video/)

`2NDQUADRANT`
# ğŸ’¡æœ¬å‘¨æç¤º


ä½¿ç”¨éƒ¨åˆ†ç´¢å¼•æ¥æé«˜æ€§èƒ½


é¡¾åæ€ä¹‰ï¼Œéƒ¨åˆ†ç´¢å¼•ä»…å¯¹è¡¨ä¸­çš„ä¸€éƒ¨åˆ†è¡Œè¿›è¡Œç´¢å¼•ã€‚ ä¸å®Œå…¨ç´¢å¼•ç›¸æ¯”ï¼Œéƒ¨åˆ†ç´¢å¼•å¯ä»¥æé«˜æ€§èƒ½ï¼Œå› ä¸ºä½¿ç”¨éƒ¨åˆ†ç´¢å¼•çš„æŸ¥è¯¢ä¸éœ€è¦æ‰«æé‚£ä¹ˆå¤šçš„è¡Œã€‚


é€šè¿‡è¿è¡ŒåŒæ—¶å…·æœ‰å®Œæ•´ç´¢å¼•å’Œéƒ¨åˆ†ç´¢å¼•çš„EXPLAINè¯­å¥å¹¶æ¯”è¾ƒæ‰«æçš„è¡Œæ•°ï¼Œå¯ä»¥çœ‹åˆ°æ€§èƒ½å·®å¼‚ã€‚

å‡è®¾æˆ‘ä»¬æœ‰ä¸€ä¸ªordersè¡¨ï¼Œå…¶ä¸­åŒ…å«1,000,000è¡Œæ•°æ®ï¼š


```
CREATE TABLE orders (
Â  id INT PRIMARY KEY,
Â  customer_id INT,
Â  status TEXT
);

INSERT INTO orders (id, customer_id, status)

SELECT
Â  i,
Â  (random()*10000)::INT,
Â  CASE (random() * 2)::int
Â Â Â Â WHEN 0 THEN 'pending'
Â Â Â Â WHEN 1 THEN 'shipped'
Â Â Â Â WHEN 2 THEN 'completed'
Â  END
Â Â Â Â FROM generate_series(1, 1000000) i;
```


é¦–å…ˆï¼Œæˆ‘ä»¬åœ¨customer_idåˆ—ä¸Šæ·»åŠ äºŒçº§ç´¢å¼•ï¼š


```
CREATE INDEX full_idx ON orders (customer_id);
```


å‡è®¾ç»å¸¸æŸ¥è¯¢ç‰¹å®šå®¢æˆ·çš„ä¸å®Œæ•´è®¢å•ã€‚ ä½¿ç”¨ç¤ºä¾‹SELECTæŸ¥è¯¢è¿›è¡Œçš„ç®€å•EXPLAIN ANALYZEåˆ†ææ˜¾ç¤ºï¼Œåœ¨full_idxä¸­æ‰«æäº†108è¡Œï¼Œä¹‹åè¿‡æ»¤å™¨åˆ é™¤äº†36è¡Œï¼š


```
EXPLAIN SELECT * FROM orders where customer_id = 1001 AND status != 'completed';

Â Â Â Â Â Â Â Â Â Â Â Â QUERY PLAN
------------------------------------
Â Bitmap Heap Scan on orders
Â  (actual time=0.041..0.116 rows=72 loops=1)
Â Â Â Recheck Cond: (customer_id = 1001)
Â Â Â Filter: (status <> 'completed'::text)
Â Â Â Rows Removed by Filter: 36
Â Â Â Heap Blocks: exact=108
Â Â Â ->Â Â Bitmap Index Scan on full_idx
Â Â Â Â Â Â Â (actual time=0.026..0.026 rows=108 loops=1)
Â  Index Cond: (customer_id = 1001)
```


é€šè¿‡åˆ›å»ºä»…ç´¢å¼•ä¸å®Œæ•´è®¢å•çš„éƒ¨åˆ†ç´¢å¼•ï¼Œæˆ‘ä»¬å¯ä»¥å‡å°‘æ‰«æçš„è¡Œæ•°ã€‚ è¿è¡Œä¸ä¸Šé¢ç›¸åŒçš„EXPLAIN ANALYZEï¼Œå°†æ˜¾ç¤ºåœ¨partial_idxä¸­ä»…æ‰«ææ»¡è¶³æŸ¥è¯¢çš„72è¡Œï¼š


```
CREATE INDEX partial ON orders (customer_id)
Â  WHERE status != 'completed';
Â  
EXPLAIN SELECT * FROM orders WHERE
Â  customer_id = 1001 AND status != 'completed';

Â Â Â Â Â Â Â Â Â Â Â Â QUERY PLAN
------------------------------------
Â Bitmap Heap Scan on orders
Â  (actual time=0.043..0.100 rows=72 loops=1)
Â Â Â Recheck Cond: ((customer_id = 1001) AND
Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â Â (status <> 'completed'::text))
Â Â Â Heap Blocks: exact=72
Â Â Â ->Â Â Bitmap Index Scan on partial_idx
Â Â Â Â Â Â Â (actual time=0.034..0.034 rows=72 loops=1)
Â  Index Cond: (customer_id = 1001)
```

æœ¬å‘¨çš„æç¤ºç”±CockroachDBçš„åˆ›å»ºè€…Cockroach LabsèµåŠ©ã€‚ éƒ¨åˆ†ç´¢å¼•å³å°†åœ¨ç‰ˆæœ¬20.2ä¸­æä¾›ã€‚ åœ¨æ­¤æ¼”ç¤ºä¸­äº†è§£æœ‰å…³CockroachDBçš„ä¿¡æ¯ï¼šâ€œåˆ†å¸ƒå¼SQLï¼šç°ä»£çš„äº‘åŸç”ŸPostgreSQLã€‚â€
